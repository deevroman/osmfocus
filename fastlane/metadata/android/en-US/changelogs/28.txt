Made download more robust, added settings
